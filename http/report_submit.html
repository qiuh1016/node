<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>Main</title>
    <script src="js/mui.min.js"></script>
    <link href="css/mui.min.css" rel="stylesheet"/>
    <style>
			html,
			body {
				background-color: #efeff4;
			}
			a.mui-navigate-right {
				font-size: 13px;
			}
			/*p {
				text-indent: 22px;
			}*/
			span.mui-icon {
				font-size: 14px;
				color: #007aff;
				margin-left: -15px;
				padding-right: 10px;
			}
			.mui-off-canvas-left {
				color: #fff;
			}
			.title {
				margin: 35px 15px 10px;
				color: #EEEEEE;
			}
			.title+.content {
				margin: 10px 15px 35px;
				color: #bbb;
				text-indent: 1em;
				font-size: 14px;
				line-height: 24px;
			}
			input {
				color: #000;
			}
		</style>
    <script type="text/javascript" charset="utf-8">
      	mui.init();
    </script>
</head>
<body>
	<!-- 侧滑导航根容器 -->
	<div id="offCanvasWrapper" class="mui-off-canvas-wrap mui-draggable mui-slide-in">
		<!-- 菜单容器 -->
		<aside id="offCanvasSide" class="mui-off-canvas-right">
			<div id="offCanvasSideScroll" class="mui-scroll-wrapper">
				<div class="mui-scroll">
					<!-- 菜单具体展示内容 -->
				    <div class="title" style="margin-bottom: 25px;">功能选择</div>
					<!--<div class="content">
						这是可拖动式侧滑菜单示例，你可以在这里放置任何内容；关闭侧滑菜单有多种方式： 1.在手机屏幕任意位置向左拖动(drag)；2.点击本侧滑菜单页之外的任意位置; 3.点击如下红色按钮
						<span class="android-only">；4.Android手机按back键；5.Android手机按menu键</span>。
					</div>-->
					<ul class="mui-table-view mui-table-view-chevron mui-table-view-inverted">
						<li class="mui-table-view-cell">
							<a class="mui-navigate-right" id="a1">
								查看周报
							</a>
						</li>
						<li class="mui-table-view-cell">
							<a class="mui-navigate-right" id="a2">
								月底考评(待开发)
							</a>
						</li>
						<li class="mui-table-view-cell">
							<a class="mui-navigate-right" id="a3">
								人月统计(待开发)
							</a>
						</li>
						<li class="mui-table-view-cell">
							<a class="mui-navigate-right" id="a4">
								合同领号(待开发)
							</a>
						</li>
					</ul>
					
					<div class="title" style="margin-bottom: 25px;">用户设置</div>
					<ul class="mui-table-view mui-table-view-chevron mui-table-view-inverted">
						<li class="mui-table-view-cell">
							<a class="mui-navigate-right" id="a5">
								修改密码
							</a>
						</li>
						<li class="mui-table-view-cell" style="background-color: #ED6A65;">
							<a class="mui-navigate-right" id="a6" >
								退出登陆
							</a>
						</li>
					</ul>

					<!--<p style="margin: 10px 15px; margin-top: 25px;">
						<button type="button" class="mui-btn mui-btn-danger mui-btn-block" style="padding: 5px 20px; font-size: 16px;" onclick="logout()">退出登陆</button>
					</p>-->
				</div>
			</div>
		</aside>
		<!-- 主页面容器 -->
		<div class="mui-inner-wrap">
			<!-- 主页面标题 -->
			<header class="mui-bar mui-bar-nav">
				
				<h1 class="mui-title">周报提交</h1>
				<a class="mui-icon mui-icon-bars mui-pull-right" href="#offCanvasSide"></a>
			</header>

			<div id="offCanvasContentScroll" class="mui-content mui-scroll-wrapper">
				<div class="mui-scroll">
			        <!-- 主界面具体展示内容 -->
			        <br>
					<form>
						<div class="mui-input-row" style="margin: 0px 10px 0px 10px;">
							<p>*项目代号：</p>
							<input type="text" id="project" name="project" class="mui-input-clear" style="font-size: 13px; color: #555555;" >
						</div>
						
						<div class="mui-input-row" style="margin: 0px 10px 0px 10px;">
							<p>*提交人：</p>
							<input type="text" id="submitter" name="submitter" readonly="readonly" style="font-size: 13px; color: #AAAAAA;">
						</div>
						
						<div class="mui-input-row" style="margin: 0px 10px 0px 10px;">
							<p>本周要重点报告的工作：</p>
							<textarea type="text" id="importance" name="importance" class="mui-input-clear" style="font-size: 13px; color: #555555;"></textarea>
						</div>
						
						<div class="mui-input-row" style="margin: 0px 10px 0px 10px;">
							<p>本周日常工作完成情况：</p>
							<textarea type="text" id="completed" name="completed" class="mui-input-clear" style="font-size: 13px; color: #555555;"></textarea>
						</div>
						
						<div class="mui-input-row" style="margin: 0px 10px 0px 10px;">
							<p>存在的问题：</p>
							<textarea type="text" id="issures" name="issures" class="mui-input-clear" style="font-size: 13px; color: #555555;"></textarea>
						</div>
						
						<div class="mui-input-row" style="margin: 0px 10px 0px 10px;">
							<p>下周重点工作计划：</p>
							<textarea type="text" id="plan" name="plan" class="mui-input-clear" style="font-size: 13px; color: #555555;"></textarea>
						</div>
						
						<div class="mui-button-row" style="margin: 0px 10px 0px 10px;">
							<button type="button" class="mui-btn mui-btn-primary mui-btn-block" onclick="submitReport()">提交</button>
						</div>
						<br>
						
					</form>
	      		</div>
			</div>  
			<!-- off-canvas backdrop 阴影-->
			<div class="mui-off-canvas-backdrop"></div>
		</div>
	</div>
	

</body>
<script type="text/javascript" charset="utf-8">

	mui.init();
	//侧滑容器父节点
	var offCanvasWrapper = mui('#offCanvasWrapper');
	
	//主界面和侧滑菜单界面均支持区域滚动；
	mui('#offCanvasSideScroll').scroll();
	mui('#offCanvasContentScroll').scroll();
	
	//侧边导航菜单点击事件
	mui('.mui-table-view').on('tap', '.mui-table-view-cell', function () {  
		var id = this.getElementsByTagName('a')[0].id;
		var i = id.substring(1, id.length);
		if (i == 1) {
			mui.openWindow({
				url:'report_list_pullrefresh_main.html'
			});
		} else if (i == 2) {
			mui.toast('月底考评(待开发)');
		} else if (i == 3) {
			mui.toast('人月统计(待开发)');
		} else if (i == 4) {
			mui.toast('合同领号(待开发)');
		} else if (i == 5) {
			mui.openWindow({
				url:'change_password.html'
			});
		} else if (i == 6) {
			logout();
		}
	})  

	window.onload = function() {
		if (localStorage.username == null) {
			mui.openWindow({
				url: 'login.html'
			});
		} else{
			document.getElementById('submitter').value = localStorage.username;
		}
	}

	function submitReport() {
		var project = document.getElementById('project').value;
		var submitter = document.getElementById('submitter').value;
		var importance = document.getElementById('importance').value;
		var completed = document.getElementById('completed').value;
		var issures = document.getElementById('issures').value;
		var plan = document.getElementById('plan').value;
		
		if (project == "") {
			mui.toast('项目代号不能为空');
			return;
		} else if (submitter == "") {
			mui.toast('提交人不能为空');
			return;
		}
		
		var _url = '/report_submit';
		mui.getJSON(_url, {project:project, submitter: submitter, importance: importance, completed: completed, issures: issures, plan: plan}, function(data) {
				//获得服务器响应
				dataJson = data;
				if (data['success']) {
					mui.alert('提交成功','提示','OK',function (e) {
					   mui.openWindow({
					   		url:'report_list.html'
					   });
					},'div')
				} else{
					mui.toast('提交失败');
				}
			}
		);
	}
	
	function logout() {
		offCanvasWrapper.offCanvas('close');
		mui('.mui-popover').popover('hide', document.getElementById('sheet1'));
		mui.confirm('是否要退出登陆?','提示',['取消','退出'], function (e) {
			if (e.index == 1) {
				localStorage.removeItem('username');
				localStorage.removeItem('permission');
				mui.openWindow({
					url:'login.html'
				});
			}
		},'div')
	}

</script>
</html>